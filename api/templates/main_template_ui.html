<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>TenderBot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="{{ url_for('static', path='/favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}?v=3">
</head>
<body>
  <div class="container">
    <h1>TenderBot</h1>

    <div class="layout">
      <!-- Левая колонка: ИИ -->
      <div class="card">
        <h2>ИИ помощник</h2>
        <div class="card-body">
          <form method="post" action="/">
            <div class="form-row">
              <input type="text" name="prompt" placeholder="Спроси ИИ..." value="{{ user_prompt or '' }}" required>
              <button type="submit">Спросить</button>
            </div>
          </form>

          <div class="answer">
            {% if ai_answer %}
              <div><strong>Ответ:</strong></div>
              <div>{{ ai_answer | replace('\n','<br>') | safe }}</div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Правая колонка: Поиск тендеров -->
      <div class="card">
        <h2>Поиск тендеров</h2>
        <div class="card-body">
          <form id="search-form" onsubmit="return false;">
            <div class="form-row">
                <input type="text" id="searchInput" placeholder="Введите запрос"/>
                <button onclick="doSearch()">Искать</button>
            </div>
          </form>

          <div id="results" class="results"></div>
        </div>
      </div>
    </div>
  </div>

<script>
async function doSearch() {
  const qEl = document.getElementById("searchInput");
  const query = qEl.value.trim();
  if (!query) { qEl.focus(); return; }

  const res = await fetch(`/search?q=${encodeURIComponent(query)}`);
  if (!res.ok) {
    document.getElementById("results").innerText = "Ошибка запроса";
    return;
  }
  const data = await res.json();

  let out = "";
  if (!data.ok) {
    out = "Ошибка запроса: " + (data.error || "");
  } else {
    const pw = data.playwright || [];
    const se = data.selenium || [];

    out = `<h3>Playwright (${data.playwright_count ?? pw.length})</h3><ul>`;
    for (const item of pw) out += `<li>${item.title || JSON.stringify(item)}</li>`;
    out += "</ul>";

    out += `<h3>Selenium (${data.selenium_count ?? se.length})</h3><ul>`;
    for (const item of se) out += `<li>${item.title || JSON.stringify(item)}</li>`;
    out += "</ul>";
  }
  document.getElementById("results").innerHTML = out;
}
</script>

</body>
</html>
